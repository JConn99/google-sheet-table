<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: transparent;
}

#custom-table {
  max-width: 100%;
  overflow-x: auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

th {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 16px;
  text-align: left;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 12px;
  letter-spacing: 0.5px;
  cursor: pointer;
  user-select: none;
  position: relative;
}

th:hover {
  background: linear-gradient(135deg, #5568d3 0%, #63408b 100%);
}

th.sortable::after {
  content: ' ⇅';
  opacity: 0.5;
  font-size: 14px;
}

th.sorted-asc::after {
  content: ' ▲';
  opacity: 1;
}

th.sorted-desc::after {
  content: ' ▼';
  opacity: 1;
}

td {
  padding: 14px 16px;
  border-bottom: 1px solid #e5e7eb;
  color: #374151;
}

tr:last-child td {
  border-bottom: none;
}

tbody tr:hover {
  background: #f9fafb;
}

.loading {
  text-align: center;
  padding: 40px;
  color: #6b7280;
}
</style>
</head>
<body>
<div id="custom-table">
  <div class="loading">Loading data...</div>
</div>

<script>
var API_URL = 'https://script.google.com/macros/s/AKfycbzAhG4WtObR3IpGeCcsnmp6RKImp3f_cU_S4xM-paDpELd4UxizE_Yfp_cbtGLPQY2m6w/exec';

var percentageColumns = [
  'saturday_poss_points_per',
  'saturday_win_per',
  'sunday_poss_points_per',
  'sunday_win_per',
  'total_poss_points_per',
  'total_win_per'
];

var tableData = [];
var tableHeaders = [];
var currentSort = { column: null, direction: 'asc' };

function formatValue(header, value) {
  if (value === '' || value === null || value === undefined) {
    return '0';
  }
  
  if (percentageColumns.indexOf(header) !== -1) {
    var numValue = parseFloat(value);
    if (!isNaN(numValue)) {
      return (numValue * 100).toFixed(1) + '%';
    }
    return '0.0%';
  }
  
  return value;
}

function getRawValue(header, value) {
  if (value === '' || value === null || value === undefined) {
    return 0;
  }
  
  if (percentageColumns.indexOf(header) !== -1) {
    var numValue = parseFloat(value);
    return isNaN(numValue) ? 0 : numValue;
  }
  
  var num = parseFloat(value);
  return isNaN(num) ? value : num;
}

window.sortTable = function(columnIndex) {
  console.log('Sorting column:', columnIndex);
  var column = tableHeaders[columnIndex];
  
  if (currentSort.column === columnIndex) {
    currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
  } else {
    currentSort.column = columnIndex;
    currentSort.direction = 'asc';
  }
  
  console.log('Sort direction:', currentSort.direction);
  
  tableData.sort(function(a, b) {
    var aVal = getRawValue(column, a[column]);
    var bVal = getRawValue(column, b[column]);
    
    if (typeof aVal === 'string' && typeof bVal === 'string') {
      aVal = aVal.toLowerCase();
      bVal = bVal.toLowerCase();
    }
    
    if (aVal < bVal) return currentSort.direction === 'asc' ? -1 : 1;
    if (aVal > bVal) return currentSort.direction === 'asc' ? 1 : -1;
    return 0;
  });
  
  renderTable();
}

function renderTable() {
  console.log('Rendering table');
  var html = '<table><thead><tr>';
  
  for (var i = 0; i < tableHeaders.length; i++) {
    var sortClass = 'sortable';
    if (currentSort.column === i) {
      sortClass = currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc';
    }
    html += '<th class="' + sortClass + '" onclick="sortTable(' + i + ')">' + tableHeaders[i] + '</th>';
  }
  html += '</tr></thead><tbody>';
  
  for (var j = 0; j < tableData.length; j++) {
    html += '<tr>';
    for (var k = 0; k < tableHeaders.length; k++) {
      var value = tableData[j][tableHeaders[k]];
      var formattedValue = formatValue(tableHeaders[k], value);
      html += '<td>' + formattedValue + '</td>';
    }
    html += '</tr>';
  }
  
  html += '</tbody></table>';
  document.getElementById('custom-table').innerHTML = html;
}

fetch(API_URL)
  .then(function(res) { return res.json(); })
  .then(function(response) {
    tableData = response.data;
    var tableDiv = document.getElementById('custom-table');
    
    if (!tableData || tableData.length === 0) {
      tableDiv.innerHTML = '<p>No data available</p>';
      return;
    }
    
    tableHeaders = Object.keys(tableData[0]);
    console.log('Headers loaded:', tableHeaders);
    renderTable();
  })
  .catch(function(error) {
    console.error('Error:', error);
    document.getElementById('custom-table').innerHTML = '<p style="color: red;">Error loading data.</p>';
  });
</script>
</body>
</html>
